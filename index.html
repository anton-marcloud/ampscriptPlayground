<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>
        * {
            box-sizing: border-box;
            --lightest: #f0eff3;
            --light: #D8D2E1;
            --mid: #B88E8D;
            --dark: #34435E;
        }

        body {
            background-color: var(--lightest);
            color: var(--dark);
        }
    </style>

</head>
<body>

    <H1>TEST 004</H1>
    %%[
    SET @key= RequestParameter("key")

    ]%%

    %%= v(@key) =%%

    <script>

        function getParameterByName(name) {
            name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
            let regexS = "[\\?&]" + name.toLowerCase() + "=([^&#]*)";
            let regex = new RegExp(regexS);
            let results = regex.exec(window.location.search.toLowerCase());
            if (results == null) {
                return "";
            }
            else {
                return decodeURIComponent(results[1].replace(/\+/g, " "));
            }
        }

        function setCookie(cName, cValue, expDays) {
            let date = new Date();
            date.setTime(date.getTime() + (expDays * 24 * 60 * 60 * 1000));
            const expires = "expires=" + date.toUTCString();
            document.cookie = cName + "=" + cValue + "; " + expires + '; path=/' + '; domain=' + location.hostname + '; secure';
        }

        function getCookie(cname) {
            let name = cname + "=";
            let decodedCookie = decodeURIComponent(document.cookie);
            let ca = decodedCookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        let iframe = document.querySelectorAll('iframe');
        let pSource = getParameterByName('utm_source');
        let pMedium = getParameterByName('utm_medium');
        let pCampaign = getParameterByName('utm_campaign');
        let pContent = getParameterByName('utm_content');
        let pTerm = getParameterByName('utm_term');
        
        if (getParameterByName('utm_source')) {
            setCookie('utmTracking', '?utm_source=' + pSource + '&utm_medium=' + pMedium + '&utm_campaign=' + pCampaign + '&utm_content=' + pContent + '&utm_term=' + pTerm, 3650);
        } else {}

        if (getCookie('utmTracking')) {
            for (ind = 0; ind < iframe.length; ind++) {
                iframe[ind].src += getCookie('utmTracking');
            }
        } else {}

    </script>
    </body>
</html>